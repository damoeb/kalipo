<div class="row">
    <h2>{{thread.title}}</h2>
</div>

<div class="row">

    <div ng-show="thread.tags!=null && thread.tags.length>0">
        <a href="#/tags/{{tag.name}}" ng-repeat="tag in thread.tags" class="badge">
            {{tag.name}}
        </a>
    </div>

    <h4>
        <span ng-show="thread.commentCount == 1">{{thread.commentCount}} comment</span>
        <span ng-show="thread.commentCount != 1">{{thread.commentCount}} comments</span>

        <span ng-show="thread.authorCount == 1">{{thread.authorCount}} authors</span>
        <span ng-show="thread.authorCount != 1">{{thread.authorCount}} authors</span>

        {{thread.createdDate | fromNow}}
    </h4>


</div>

<div class="row box">

    <!-- header -->

    <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav nav-pills">

            <li class="dropdown pointer">
                <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;">
                                <span>
                                    <span class="hidden-tablet">Sorted by Best</span>
                                    <b class="caret"></b>
                                </span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="javascript:;">
                        &#xA0;<span>Date</span></a></li>
                    <li><a href="javascript:;">
                        &#xA0;<span>Rating</span></a></li>
                </ul>
            </li>

        </ul>

    </div>

    <!-- content -->

    <div style="margin-top: 15px">

        <div ng-show="!doComment" ng-click="doComment = true">
            <div ng-include="'pre_create_comment_renderer.html'">
            </div>
        </div>
        <div ng-show="doComment">
            <div ng-include="'create_comment_renderer.html'">
            </div>
        </div>

        <dl style="margin:0;">
            <dd ng-repeat="comment in comments | orderBy:createdDate" ng-include="'comment_renderer.html'">

            </dd>
        </dl>

        <div ng-show="comments.length > 10" style="margin-top: 10px">
        <div ng-include="'create_comment_renderer.html'"></div>
        </div>

    </div>
</div>

<script type="text/ng-template" id="likes_renderer.html">
    <div ng-show="comment.dislikes > 0 || comment.likes > 0">
        <div ng-show="comment.dislikes > 0" style="color: red; display: inline-block">
            {{comment.dislikes}}
            <div style="height:5px; background-color: red; width: {{3 * comment.dislikes}}px; max-width: 120px; display: inline-block; margin: 2px 0 2px 0"></div>
        </div>
        <div ng-show="comment.likes > 0" style="color: green; display: inline-block">
            <div style="height:5px; background-color: green; width: {{3 * comment.likes}}px; max-width: 120px; display: inline-block; margin: 2px 0 2px 0"></div>
            {{comment.likes}}
        </div>
    </div>
</script>

<script type="text/ng-template" id="create_comment_renderer.html">

    <div style="padding: 10px; margin-bottom: 10px;">
        <h4>Your comment</h4>

        <form name="form" role="form" novalidate ng-submit="draft.parentId = null; create()">
            <div><input class="form-control" ng-model="draft.title" ng-minlength=1 ng-maxlength=148
                        placeholder="Title"></div>
            <div><textarea class="form-control" placeholder="Type your comment here..." ng-model="draft.text"
                           ng-minlength=1 ng-maxlength=2048 required></textarea></div>

            <div>
                <button type="submit" ng-disabled="form.$invalid" class="btn btn-primary">
                    Post
                </button>
            </div>

        </form>

    </div>

</script>

<script type="text/ng-template" id="pre_create_comment_renderer.html">

    <div style="padding: 10px; margin-bottom: 10px;">

        <textarea class="form-control" placeholder="Type your comment here..." ng-model="draft.text"
                  ng-minlength=1 ng-maxlength=2048 required rows="1"></textarea>

    </div>

</script>

<script type="text/ng-template" id="replyto_comment_renderer.html">

    <div style="padding: 10px;">

        <form name="form" role="form" novalidate ng-submit="draft.parentId = comment.id; create()">
            <h4>Reply</h4>
            <input class="form-control" ng-model="draft.title" ng-minlength=1 ng-maxlength=148
                   placeholder="Title..."/>

            <div><textarea class="form-control" placeholder="Type your comment here..." ng-model="draft.text"
                           ng-minlength=1 ng-maxlength=2048 required></textarea></div>

            <div class="btn-group">
                <button type="button" class="btn btn-default" ng-click="comment.reply = false" title="Cancel">
                    Cancel
                </button>
                <button type="submit" ng-disabled="form.$invalid" class="btn btn-primary">
                    Post
                </button>
            </div>

        </form>

    </div>

</script>

<script type="text/ng-template" id="comment_renderer.html">

    <div>

        <div ng-switch on="comment.maximized">

            <!-- Maximized view -->
            <div ng-switch-default>

                <div ng-include="'likes_renderer.html'"></div>

                <div class="post">
                    <a id="{{comment.id}}"></a>

                    <div>
                        <div class="menu" style="display: inline">
                            <a href="javascript:void(0)"
                               ng-click="comment.maximized = !comment.maximized" title="Click to minimize">
                                <span class="glyphicon glyphicon-resize-small"></span></a>
                        </div>

                        <strong>
                            {{comment.title}}
                        </strong>

                        <span class="pull-right" style="color: grey" title="{{comment.createdDate | dateString }}">{{comment.createdDate | fromNow }}</span>

                    </div>

                    <div>
                        <span style="white-space: pre-line">{{comment.text}}</span> --
                        <span style="color: grey">by <a
                                href="#/users/{{comment.authorId}}">{{comment.authorId}}</a></span>
                    </div>

                    <div class="menu" style="border-top: 1px solid #efefef;">
                        <a href="javascript:void(0)" ng-click="toggleReplyForm(comment)">
                            Reply
                        </a>
                        <a class="voteUp" href="javascript:void(0)" ng-click="like(comment)">
                            <span class="glyphicon glyphicon-thumbs-up"></span>
                        </a>
                        <a class="voteDown" href="javascript:void(0)" ng-click="dislike(comment)">
                            <span class="glyphicon glyphicon-thumbs-down"></span>
                        </a>
                        <a ng-show="comment.parentId != null" href="javascript:void(0)"
                           ng-click="scrollTo(comment.parentId)">
                            Parent
                        </a>
                        <a href="#/thread/{{comment.threadId}}/{{comment.id}}" title="Permalink">
                            <span class="glyphicon glyphicon-link"></span>
                        </a>

                        <div class="flag pull-right">
                            <a href="javascript:void(0)"
                               ng-click="toggleReportForm(comment)"
                               title="Report this comment">
                                <span class="glyphicon glyphicon-flag"></span>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="input-group"
                     style="margin-bottom: 20px; padding: 10px; background-color: #cbdaef; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px"
                     ng-show="comment.report">
                    <input type="text" ng-maxlength=148 ng-minlength=1 ng-model="reportModel.reason"
                           placeholder="Tell us, what is wrong with this comment"
                           class="form-control ng-valid ng-valid-maxlength ng-valid-minlength">
                <span class="input-group-btn">
                    <button class="btn btn-default" type="button" ng-click="comment.report = false" title="Cancel"><span
                            class="glyphicon glyphicon-remove"></span></button>
                    <button class="btn btn-primary" type="button" ng-click="report(comment)">Send Report
                    </button>
                </span>
                </div>
                <!-- /input-group -->

                <div style="border-left: 10px solid #dedede; background-color: #fcf8e5;">
                    <div ng-show="comment.reply">
                        <div ng-include="'replyto_comment_renderer.html'"></div>
                    </div>

                    <!-- sub comments -->
                    <div ng-hide="comment.subcomments.length == 0">
                        <dl style="margin:0;">
                            <dd ng-repeat="comment in comment.subcomments | orderBy:createdDate"
                                ng-include="'comment_renderer.html'"></dd>
                        </dl>
                    </div>

                </div>

            </div>

            <!-- Minimized view -->

            <div ng-switch-when="false">

                <div class="minimized post" style="cursor: pointer;" title="Click to maximize">

                    <!--<strong><a href="javascript:void(0)" ng-click="scrollTo(comment.parentId)"-->
                    <!--ng-show="{{comment.parentId != null}}">Re:</a></strong>-->

                    <div style="overflow: hidden; max-height:3em; min-height:1.8em;"
                         ng-click="comment.maximized = !comment.maximized">

                        <div style="display: inline">
                            <a href="javascript:void(0)">
                                <span class="glyphicon glyphicon-resize-full"></span></a>

                            <!--<span ng-show="comment.parentId == null" class="glyphicon glyphicon-leaf"-->
                            <!--style="color: #666"></span>-->

                            <strong>{{comment.title}}</strong>
                            <span style="color: grey">({{comment.subcomments.length}} children)</span>
                        </div>

                        <div style="white-space: nowrap; cursor: pointer; color: grey; display: inline">
                            <span>{{comment.text}}</span>
                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</script>